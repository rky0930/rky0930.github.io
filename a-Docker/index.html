<!DOCTYPE html>
<html class="no-js" lang="pt-br">
  <head>
<meta charset="utf-8">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
<link rel="alternate" href="http://rky0930.github.io" hreflang="pt-BR">
<link href="http://gmpg.org/xfn/11" rel="profile">
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="theme-color" content="#005344">
<title> Docker | Ryoo Gyoung-Yoon</title>
<meta name="google-site-verification" content="zS1dSn20XtA4FJYEOQLXqI0boxZdMnJ2g3beje-cl20">
<meta name="description" content="Docker">
<meta name="keywords" content="">
<!-- Social: Facebook / Open Graph -->
<meta property="og:url" content="http://rky0930.github.io/a-Docker/">
<meta property="og:title" content=" Docker | Ryoo Gyoung-Yoon">
<meta property="og:description" content="Docker">
<meta property="og:site_name" content="Ryoo Gyoung-Yoon">
<meta property="og:locale" content="pt_BR">
<meta property="og:type" content="website">
<meta property="og:author" content="http://facebook.com/rky0930">
<meta property="og:image" content="http://rky0930.github.io">
<!-- Social: Twitter -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@nandomoreirame">
<meta name="twitter:domain" content="http://rky0930.github.io">
<meta name="twitter:title" content=" Docker | Ryoo Gyoung-Yoon">
<meta name="twitter:description" content="Docker">
<meta name="twitter:image:src" content="http://rky0930.github.io">
<!-- Favicons -->
<link rel="apple-touch-icon" sizes="114x114" href="http://rky0930.github.io/assets/ico/apple-touch-icon-114-516f4e19976b9e4dbb77ad9b576831fe.png">
<link rel="apple-touch-icon" sizes="72x72" href="http://rky0930.github.io/assets/ico/apple-touch-icon-72-5409b2df229305703caf583d86c845ab.png">
<link rel="apple-touch-icon" href="http://rky0930.github.io/assets/ico/apple-touch-icon-57-aa873e019cf659e0d4e6a0b5bb9f379d.png">
<link rel="shortcut icon" href="http://rky0930.github.io/assets/ico/favicon-b5ecc36e2f9d7bd353ee91851eb81a94.png">
<!-- rel prev and next -->
<!-- Canonical link tag -->
<link rel="canonical" href="http://rky0930.github.io/a-Docker/">
<link rel="alternate" type="application/rss+xml" title="Ryoo Gyoung-Yoon" href="http://rky0930.github.io/feed.xml">
<link rel="stylesheet" href="/assets/main-e03fd29918e6a55fb4e40f4e044772fc.css">
<script src="/assets/modernizr-custom-cb807611a3e262b2eac59444cbab74d6.js" data-cfasync="false"></script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Website",
  "publisher": "rky0930.github.io",
  "url": "http://rky0930.github.io/",
  "description": ""
}
</script>
<script type="text/javascript">
  var disqus_shortname = 'tech blog',
      baseurl          = '';
</script>
<script type="text/javascript">
var _gaq = _gaq || [];
_gaq.push(['_setAccount', '']);
_gaq.push(['_trackPageview']);
(function() {
  var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
  ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
  var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
})();
</script>
    <meta name="robots" content="noindex"> <!--=====  Please remove it ! ! !  ======-->
    <meta name="googlebot" content="noindex"> <!--=====  Please remove it ! ! !  ======-->
  </head>
  <body class="post-template single">
    <header class="header">
  <div class="container">
    <h1><a href="/"><strong>rky0930</strong>.github.io</a></h1>
    <nav class="navbar">
      <ul>
        <li><a href="/">Home</a></li>
        <li><a href="#!" data-modal="modalSearch"><i class="fa fa-search"></i></a></li>
        <!--<li><a href="/feed.xml" target="_blank"><i class="fa fa-feed"></i></a></li>-->
      </ul>
    </nav>
  </div>
</header>
    <main class="wrapper container" itemprop="mainContentOfPage" itemscope="itemscope" itemtype="http://schema.org/Blog">
      <article class="post" itemscope="itemscope" itemtype="http://schema.org/BlogPosting" itemprop="blogPost">
  <header class="post-header">
    <h1>Docker</h1>
    <div class="post-meta">
      <time datetime="2015-10-13">
        <i class="fa fa-calendar-o"></i> <time datetime="2017-06-02"> 2017-06-02
      </time>
      <span>
        <i class="fa fa-comments"></i> <a href="/a-Docker/#disqus_thread" data-disqus-identifier="/a-Docker">Leave a comment</a>
      </span>
      <span>
        <i class="fa fa-folder-open-o"></i> 
      </span>
    </div>
  </header>
  <h1 id="docker">Docker</h1>
<h3 id="sudo-----docker---">sudo를 매번 입력하지 않기 위해 Docker 그룹에 유저 넣기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">sudo usermod -aG docker <span class="k">${</span><span class="nv">USER</span><span class="k">}</span>
sudo service docker restart</code></pre></div>
<h3 id="section">이미지 찾기</h3>
<ul>
  <li>웹: https://hub.docker.com</li>
  <li>이름: 공식이미지, 올린사람id/이지미이름</li>
  <li>Tags: 이미지 변경에 따른 버전 관리</li>
  <li>최신 Tags가 Latest로 명시됨</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">명령어: docker search &lt;이미지이름&gt;  
ex<span class="o">)</span> docker search</code></pre></div>
<h3 id="pull">이미지 다운로드(pull)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker pull &lt;이미지이름&gt;:&lt;태그&gt;
ex<span class="o">)</span> docker pull redis:Latest
    redis 최신 이미지 받기<span class="o">(</span>테그 명시 안하면 최신으로 받음<span class="o">)</span></code></pre></div>
<h3 id="section-1">이미지 확인</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker images</code></pre></div>
<h3 id="section-2">이미지 실행(컨테이너 만들기)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker run -i -t --name &lt;컨테이너이름&gt; -d &lt;이미지이름&gt;
: -i -t <span class="o">(</span>interative 모드<span class="o">)</span>
 ex<span class="o">)</span> docker run -i -t --name myredis -d redis</code></pre></div>
<h3 id="section-3">컨테이너 확인</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker ps 
docker ps -a 
 : -a <span class="o">(</span>정지된 컨테이너도 표시<span class="o">)</span></code></pre></div>
<p><br /></p>
<h2 id="section-4">컨테이너 다루기</h2>
<h3 id="section-5">컨테이너 실행 &amp; 정지</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker start &lt;컨테이너이름&gt;
docker stop &lt;컨테이너이름&gt;</code></pre></div>
<h3 id="section-6">컨테이너 안에서 작업하기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker <span class="nb">exec</span> -it &lt;컨테이너이름&gt; &lt;실행할 명령&gt;
: -it <span class="o">(</span>인터랙티브 하게 실행<span class="o">)</span>, bash shell을 사용해라 
 ex<span class="o">)</span> docker <span class="nb">exec</span> -it myredis /bin/bash</code></pre></div>
<h3 id="section-7">컨테이너 삭제</h3>
<ul>
  <li>tips: 복수 명령도 가능 (한칸 띄고 다른 컨테이너이름)</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker rm &lt;컨테이너 이름&gt;</code></pre></div>
<h3 id="section-8">이미지 삭제</h3>
<ul>
  <li>Notice: 태그이름 입력안하면 모든 태그 삭제됨</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker rmi &lt;이미지이름&gt;:&lt;태그&gt;</code></pre></div>
<h3 id="section-9">로그</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker logs -ft &lt;컨테이너이름&gt; 
 -ft: tail</code></pre></div>
<h2 id="section-10">자원 제한 방법</h2>
<h3 id="cpu-">CPU 제한</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker run -ti --c &lt;제한값&gt; &lt;이미지이름&gt; &lt;실행할 명령&gt;
ex<span class="o">)</span> docker run -ti -c <span class="m">512</span> ubuntu:16.04 /bin/bash
 -c or --cpu-share
 * 상대적인 비율: 각 컨테이너에 주는 숫자의 합을 비율로 하여 CPU사용 제한</code></pre></div>
<h3 id="memory-">Memory 제한</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker run -ti -m &lt;size&gt; &lt;이미지이름&gt; &lt;실행할 명령&gt;
ex<span class="o">)</span> docker run -ti -m 300M ubuntu:16.04 /bin/bash
 -m or --memory 
 * 메모리 제한 값 최소 4M
 * 별도의 설정이 없다면 swap도 300M <span class="o">(</span>swap+memory<span class="o">)</span> <span class="o">=</span> 600M 
 * 단위: b, k, m, g</code></pre></div>
<h3 id="swap-memory-">swap memory 제한</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker run -ti -m &lt;size&gt; --memory-swap &lt;size&gt; &lt;이미지이름&gt; &lt;실행할 명령&gt;
ex<span class="o">)</span> docker run -ti -m 300M --memory-swap 1G ubuntu:16.04 /bin/bash
 : 메모리 사용량은 <span class="o">(</span>swap+memory<span class="o">)</span> <span class="o">=</span> <span class="nv">1G</span> <span class="o">=</span>&gt; swap memory로 설정된 값은 700M</code></pre></div>
<p><br /></p>
<h2 id="section-11">도커 관리를 위한 꿀 팁</h2>
<h3 id="section-12">실행중인 모든 컨테이너 죽이기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker <span class="nb">kill</span> <span class="k">$(</span>docker ps -q<span class="k">)</span></code></pre></div>
<h3 id="section-13">정지된 것을 포함해서, 모든 컨테이너를 삭제한다</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker rm <span class="k">$(</span>docker ps -a -q<span class="k">)</span></code></pre></div>
<h3 id="section-14">오래된 컨테이너 삭제</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker ps -a <span class="p">|</span> grep <span class="s1">&#39;weeks ago&#39;</span> <span class="p">|</span> awk <span class="s1">&#39;{print $1}&#39;</span> <span class="p">|</span> xargs docker rm</code></pre></div>
<h3 id="section-15">정지된 컨테이너를 삭제</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker rm -v <span class="k">$(</span>docker ps -a -q -f <span class="nv">status</span><span class="o">=</span>exited<span class="k">)</span></code></pre></div>
<h3 id="section-16">불필요한 이미지를 제거한다</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker rmi <span class="k">$(</span>docekr images -q -f <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span><span class="k">)</span></code></pre></div>
<h3 id="section-17">불필요한 볼륨을 제거한다</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker volume rm <span class="k">$(</span>docker volume ls -q <span class="nv">dangling</span><span class="o">=</span><span class="nb">true</span><span class="k">)</span></code></pre></div>
<p><br /></p>
<h2 id="docker-----">docker 이미지나 컨테이너를 파일로 저장하는 법</h2>
<h3 id="load-or-save-image">load or save image</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> docker load &lt; my_image.tar.gz
ex<span class="o">)</span> docker save my_image:my_tag &gt; my_image.tar.gz</code></pre></div>
<h3 id="load-or-save-container">load or save Container</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> cat my_container.tar.gz <span class="p">|</span> docker import - my_image:my_tag
ex<span class="o">)</span> docker <span class="nb">export </span>my_container &gt; my_container.tar.gz</code></pre></div>
<h3 id="read-only-container">Read-only Container</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> docker run --read-only</code></pre></div>
<p><br /></p>
<h2 id="section-18">컨테이너 모니터링 하기</h2>
<h3 id="cpu-memory-network-io">하나의 컨테이너의 자원 사용량 모니터링(CPU, memory, network I/O)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker stats &lt;Container&gt;</code></pre></div>
<h3 id="container-id-">모든 컨테이너의 자원 사용량 모니터링(Container ID로 정렬)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker stats <span class="k">$(</span>docker ps -q<span class="k">)</span></code></pre></div>
<h3 id="container--">모든 컨테이너의 자원 사용량 모니터링(Container 이름으로 정렬)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker stats <span class="k">$(</span>docker ps --format <span class="s1">&#39;&#39;</span><span class="k">)</span></code></pre></div>
<h3 id="ubuntu----">“ubuntu” 이미지로 만들어진 컨테이너 찾기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker ps -a -f <span class="nv">ancestor</span><span class="o">=</span>ubuntu</code></pre></div>
<p><br /></p>
<h2 id="section-19">이미지를 빌드하는 방법</h2>
<h3 id="docker-commit-">1) docker commit 명령어</h3>
<p>컨테이너 안에서 작업후 커밋하는 방법</p>
<ul>
  <li>과정 재현이 어렵고 실수하기 쉬움</li>
  <li>간단한 컨테이너 만들때 사용</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">-- 우선 실행 -- 
docker run -it ubuntu /bin/bash
-- 컨테이너 안에서 작업 --
apt-get -yqq update
apt-get -y install apache2
<span class="nb">exit</span> 
-- 컨테이너 밖에서 commit--
docker commit 5a6a75ff3e6a rky0930/apache2
docker images rky0930/apache2 <span class="o">(</span>이미지 확인<span class="o">)</span>
docker commit -m<span class="o">=</span><span class="s2">&quot;new apache2 image&quot;</span> --author<span class="o">=</span><span class="s2">&quot;rky0930&quot;</span> 5a6a75ff3e6a rky0930/apache2:webserver
 : -m 메시지 -author 저자이름 컨테이너ID 이미지이름1/이미지이름2:테그
docker inspect rky0930/apache2:webserver</code></pre></div>
<h3 id="dockerfile---docker-build-">2) Dockerfile - docker build 명령</h3>
<p>사용할 명령어를 dockerfile에 저장하고 docker build하는 방법</p>
<ul>
  <li>이미지 빌드 과정을 모두 정리하고 진행</li>
  <li>관리가 쉽고 실수가 적다</li>
</ul>
<h3 id="dockerfile--">dockerfile 이란 ?</h3>
<ul>
  <li>이미지를 빌드하는 방법과 과정을 적어놓은 파일</li>
  <li>도커 이미지의 설계도와 같다고 말할 수 있음</li>
  <li>반복적 사용가능</li>
  <li>git, svn등으로 버젼관리하면 변경 이력 추적 가능</li>
</ul>
<h3 id="dockerignore--">.dockerignore 파일 사용법</h3>
<p>이미지에 포함하고 싶지 않은 파일, 디렉토리를 지정</p>
<ul>
  <li>Context의 root directory에 위치</li>
  <li>이미지를 크게 만드는 불필요한 파일</li>
  <li>보안 때문에 넣으면 안되는 파일</li>
  <li>각 패턴마다 줄 바꿈</li>
  <li>’#’ 으로 주석처리</li>
</ul>
<h3 id="section-20">규칙및 동작</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">*/temp*   : temp라는 디랙토리 제외
*/*/temp* : sub-sub 의 temp라는 디랙토리는 제외 
**/*.java : .java 파일 제외
temp?     : tempa tempb 등 5글자중 앞에 4글자가 temp 인것은 제외</code></pre></div>
<h3 id="dockerfile-2">dockerfile 설명2</h3>
<ul>
  <li>첫 줄부터 차례로 실행</li>
  <li>한 라인이 실행 될 때 마다 이미지에 레이어 추가</li>
  <li>실행중 에러가 나면 에러가 났던 곳 부터 실행</li>
  <li>첫출은 항상 FROM으로 시작</li>
  <li>’#’ 으로 주석처리</li>
</ul>
<h3 id="section-21">파일로 빌드하기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker build -t <span class="s2">&quot;rky0930/sshd&quot;</span> .</code></pre></div>
<h3 id="section-22">빌드 이력</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker <span class="nb">history </span>rky0930/sshd</code></pre></div>
<h3 id="section-23">컨테이너 만들기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker run -d -P --name test_sshd rky0903/sshd</code></pre></div>
<h3 id="port-">port 오픈</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker port test_sshd 22</code></pre></div>
<h3 id="ipaddress-">IPAddress 확인</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker inspect --format <span class="s1">&#39;&#39;</span> test_sshd</code></pre></div>
<h3 id="ssh----22-32768">ssh 접속 (주의: 포트번호 22-&gt;32768)</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ssh root@172.17.0.2 -p 32768
 - 컨테이너에서  22
 - 컨테이너 외부에서는 32768</code></pre></div>
<p><br /></p>
<h2 id="docker-------">docker 빌드중 에러발생해도 다시 빌드하면 에러지점부터 빌드 시작</h2>
<h3 id="docker---">docker 빌드중 캐쉬를 무시하려면</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">doker build --no-cache</code></pre></div>
<h3 id="section-24">일부의 캐쉬만 무시하려면</h3>
<p>도커파일에 일부분만 수정하는 방법</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> ENV 넣어 특정부분만 무시하도록 함<span class="o">(</span>꼼수<span class="o">)</span>
FROM ubunut:16.04
ENV UPDATED_AT 2017-01-01  &lt;-- 이지점 아래부터 실행 
RUN apt-get -qq update</code></pre></div>
<h3 id="section-25">22번 포트를 그대로 쓸 수 없을까 ?</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> docker run -d -p &lt;host_port&gt;:&lt;Container_inside_port&gt; --name &lt;Containe name&gt; &lt;image name&gt;
docker run -d -p 22:22 --name test_sshd2 rky0930/sshd
 : 호스트에서 접근시 22, 컨테이너 내부 사용 포트 22
docker run -d -p 2345:22 --name test_sshd2 rky0930/sshd
 : 호스트에서 접근시 2345, 컨테이너 내부 사용 포트 22</code></pre></div>
<p><br /></p>
<h2 id="dockerfile-">Dockerfile 명령어</h2>
<h3 id="env">ENV</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ENV &lt;key&gt; &lt;value&gt;
ENV &lt;key&gt;<span class="o">=</span>&lt;value&gt;</code></pre></div>
<h3 id="section-26">환경 변수 사용</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> 
FROM ubuntu: 16.04
ENV foo /bar
WORKDIR <span class="k">${</span><span class="nv">foo</span><span class="k">}</span>     <span class="c">### WORKDIR /bar</span>
ADD .<span class="nv">$foo</span>          <span class="c">### ADD ./bar</span>
COPY <span class="se">\$</span>foo /quux   <span class="c">### COPY $foo /quux \ &lt;-- excape</span></code></pre></div>
<h3 id="section-27">조건부 환경 변수 문법</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash"><span class="k">${</span><span class="nv">A</span><span class="k">:-</span><span class="nv">B</span><span class="k">}</span>
: A가 정의되어 있으면 A, 아니면 B
<span class="k">${</span><span class="nv">A</span><span class="p">:+B</span><span class="k">}</span>
: : A가 정의되어 있으면 B, 아니면 empty</code></pre></div>
<h3 id="cmd">CMD</h3>
<ul>
  <li>컨테이너 생성할 때 실행</li>
  <li>Docker 에 하나의 CMD만 가능</li>
  <li>여러 CMD가 있다면 마지막 것 만 실행</li>
  <li>“docker build” 시점에 Dockerfile 의 CMD 설정능 오버라이드 가능</li>
  <li>ENDPOINT 명령어의 파라미터로 사용 될 수도 있음</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">1<span class="o">)</span> CMD <span class="o">[</span><span class="s2">&quot;executable&quot;</span>, <span class="s2">&quot;param1&quot;</span>, <span class="s2">&quot;param2&quot;</span><span class="o">]</span> 
2<span class="o">)</span> CMD <span class="nb">command </span>param1 param2    <span class="c">### /bin/sh -c </span>
3<span class="o">)</span> CMD <span class="o">[</span><span class="s2">&quot;param1&quot;</span>, <span class="s2">&quot;param2&quot;</span><span class="o">]</span>     <span class="c">### ENTRYPOINT</span></code></pre></div>
<h3 id="cmd-vs-run">CMD vs RUN</h3>
<ul>
  <li>RUN 은 각 명령어를 실행할 때 마다 실행 되어 commit되고 레이어로 저장됨</li>
  <li>CMD는 build 시점에는 실행되지 않음에 주의</li>
  <li>CMD는 컨테이너를 run 할 때 실행</li>
</ul>
<h3 id="entrypoint">ENTRYPOINT</h3>
<ul>
  <li>컨테이너 생성할 때 실행</li>
  <li>Dockerfile에서 하나의 ENTRYPOINT만 가능</li>
  <li>여러 ENTRYPOINT 있다면 마지막 것 만 실행</li>
  <li>“docker build” 시점에서 Dockerfile 의 ENTRYPOINT 설정을 오버라이드 가능</li>
  <li>CMD 명령어의 파라미터로 사용 될 수 도 있음</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">1<span class="o">)</span> ENTRYPOINT <span class="o">[</span><span class="s2">&quot;executable&quot;</span>, <span class="s2">&quot;param1&quot;</span>, <span class="s2">&quot;param2&quot;</span><span class="o">]</span> 
2<span class="o">)</span> ENTRYPOINT <span class="nb">command </span>param1 param2</code></pre></div>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex1<span class="o">)</span> 
CMD <span class="o">[</span><span class="s2">&quot;-T&quot;</span><span class="o">]</span>
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;/usr/sbin/sshd&quot;</span><span class="o">]</span>
<span class="o">=</span> /usr/sbin/sshd -T 
ex2<span class="o">)</span>  <span class="c">### 실행하는 명령어를 바꿀때 사용 가능 </span>
CMD <span class="o">[</span><span class="s2">&quot;-T&quot;</span><span class="o">]</span>
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;/usr/sbin/sshd&quot;</span><span class="o">]</span> 
Docker run &lt;image&gt; -D 
<span class="o">=</span> /usr/sbin/sshd -D</code></pre></div>
<p>[사진활용] 표1_CMD_ENTRYPOINT<br />
* point 조합하실때는 [””, “”] &lt;- 방법으로사용 할 것 
<img src="http://rky0930.github.io/assets/static/Docker/CMD_ENTRYPOINT.png" width="800" /></p>
<h3 id="workdir">WORKDIR</h3>
<p>RUN, CMD, ENTRYPOINT, ADD 등 을 실행 할 directory를 지정</p>
<ul>
  <li>Dockerfile에서 여러번 사용 가능</li>
  <li>상대 경로도 사용가능</li>
  <li>해당 경로가 없으면 생성됨</li>
  <li>“docker run”에서 -w 옵션으로 오버라이드 가능</li>
</ul>
<h3 id="user">USER</h3>
<p>RUN, CMD, ENTRYPOINT등 을 실행 할 유저를 지정</p>
<ul>
  <li>지정하지 않으면 root로 실행</li>
  <li>파라미터로 유저 ID나 UID를 지정</li>
</ul>
<h3 id="volume">Volume</h3>
<p>호스트와 공유할 directory설정</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> 
VOLUME <span class="o">[</span><span class="s2">&quot;/data1&quot;</span>, <span class="s2">&quot;/data2&quot;</span><span class="o">]</span>
VOLUME /data1 /data2
---
FROM ubunutu
RUN mkdir /myvol
RUN <span class="nb">echo</span> <span class="s2">&quot;hello world&quot;</span> &gt; /myvol/greeting
VOLUME /myvol
---</code></pre></div>
<h3 id="add">ADD</h3>
<p>컨테이너에 파일 추가</p>
<ul>
  <li>tar.gz ADD시 자동으로 압축 풀어서 넣어줌</li>
  <li>가져올 파일이 변경되면 ADD 명령으로 빌드 캐쉬가 무효화 될 수 있음에 주의</li>
  <li>URL 이 인증을 필요로 한다면 사용 불가</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> 
ADD hom* /mydir/
ADD hom?.txt /mydir/
ADD <span class="nb">test </span>relativeDir/
ADD <span class="nb">test</span> /absoluteDir/
ADD http://example.com/foo.zip /mydir/bar.zip
ADD foo.tar.gz /mydir/
--- 
아래와 같은 방법으로 Context 외부에서 복사 불가 <span class="o">(</span>.. 을 사용하여 상위로 가서 작업한는 것은 불가<span class="o">)</span>
ADD ../test/ /mydir/  
---</code></pre></div>
<h3 id="copy">COPY</h3>
<p>컨테이너에 파일 복사</p>
<ul>
  <li>ADD와 유사하지만 복사 기능만 제공</li>
  <li>압축 해제 같은 복사 외의 기능은 제외</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> 
COPY hom* /mydir/
COPY hom?.txt /mydir/
COPY <span class="nb">test </span>relativeDir/
COPY <span class="nb">test</span> /absoluteDir/
---
Context 외부에서 복사 불가  <span class="o">(</span>.. 을 사용하여 상위로 가서 작업한는 것은 불가<span class="o">)</span>
COPY ../test/ /mydir/  
---</code></pre></div>
<p><br /></p>
<h2 id="docker-compose">docker-compose</h2>
<p>여러 개의 컨테이너를 한번에 올리고 내릴 수 있는 툴</p>
<ul>
  <li>로컬 개발 환경, 테스트 서버, CI 등의 환경에서 사용하면 편리</li>
  <li>각 애플리케이션에 dockerfile을 정의하고, 서비스 들을 docker-compose.yml에 설정</li>
</ul>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">실행: docker-compose up
정지: docker-compose stop
확인: docker-compose ps</code></pre></div>
<h2 id="docker-compose-">docker-compose 명령어</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">image      : 사용할 이미지 설정  
dockerfile : 사용할 docekrfile을 지정  
<span class="nb">command</span>    : 기본 <span class="nb">command</span>를 새로운 값으로 오버라이드  
links      : 컨테이너 이름을 사용하면 ip 가 /etc/hosts에 저장됨  
env_file   : 환경 변수를 저정한 파일 지정  
volumes    : 마운트할 볼륨을 지정  
port       : 사용할 포트 설정  
dns        : 컨테이너가 사용할 dns 주소 설정</code></pre></div>
<h3 id="docker-compose----wordpress">docker-compose 실습 - 워드프레스(wordpress)</h3>
<p>1) docker-compose.yml</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: docker-compose.yml
version: <span class="s1">&#39;2&#39;</span>
services:
    wordpress:
        image: wordpress
        ports:
            - 8080:80
        environment:
            WORDPRESS_DB_PASSWORD: example
    mysql:
        image: mariadb
        environment:
            MYSQL_ROOT_PASSWORD: example</code></pre></div>
<p>2) 실행</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">실행: 
docker-compose up
테스트: 
localhost:8080 접속</code></pre></div>
<p><br /></p>
<h2 id="docker-hub">docker hub</h2>
<h3 id="docker-hub-image-">docker hub에 image 올리기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker login
docker push &lt;사용자이름&gt;/&lt;이미지이름2&gt;:&lt;tags&gt;
* 이미지 이름 앞에 사용자 이름이 들어가야함 <span class="o">(</span>없으면 official이 되기 때문에 문제 발생<span class="o">)</span>
ex<span class="o">)</span> 
docker push rky0930/apache2:webserver</code></pre></div>
<h3 id="docker-hub-image--1">docker hub에 image 받기</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker pull &lt;사용자이름&gt;/&lt;이미지이름2&gt;:&lt;tags&gt;
ex<span class="o">)</span> 
docker pull rky0930/apache2:webserver</code></pre></div>
<p><br /></p>
<h2 id="spring-----">Spring 실습 (에러 발생.. 디버그 필요)</h2>
<p>Java + Spring + Docker<br />
Image &amp; Source code :<br />
1) <a href="https://github.com/spring-projects/spring-petclinic">spring-petclinic</a><br />
2) <a href="https://hub.docker.com//r/library/maven/">maven</a></p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">git clone https://github.com/spring-projects/spring-petclinic.git
<span class="nb">cd </span>spring-petclinic
vi Dockerfile</code></pre></div>
<h3 id="dockerfile">Dockerfile</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: Dockerfile
--- 
FROM maven:3.3-jdk-7-onbuild
CMD <span class="o">[</span><span class="s2">&quot;mvn&quot;</span>, <span class="s2">&quot;tomcat7:run&quot;</span><span class="o">]</span>
--- 
build <span class="p">&amp;</span> run: 
docker build --tag my-spring .
docker run -rm -it -p 9966:9966 my-spring
 : -rm <span class="o">=</span> Automatically remove the container when it exits</code></pre></div>
<p><br /></p>
<h2 id="jenkins-">Jenkins 실습</h2>
<p>CI 툴, 주기 빌드 서버</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">ex<span class="o">)</span> 
<span class="c">### 실행</span>
docker run --name myjenkins -p 8080:8080 -p 50000:50000 -v /var/jenkins_home jenkins
<span class="c">### 초기 패스워드 보기 </span>
docker <span class="nb">exec</span> -it myjenkins cat /var/jenkins_home/secrets/initialAdminPassword
<span class="c">### 접속 </span>
localhost:8080</code></pre></div>
<p><br /></p>
<h2 id="nodejs-">Node.js 실습</h2>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: Dockerfile
FROM node:6.9-onbuild</code></pre></div>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: app.js
var <span class="nv">http</span> <span class="o">=</span> require<span class="o">(</span><span class="s2">&quot;http&quot;</span><span class="o">)</span><span class="p">;</span>
http.createServer<span class="o">(</span><span class="k">function</span><span class="o">(</span>req, res<span class="o">)</span> <span class="o">{</span>
    res.writeHead<span class="o">(</span>200, <span class="o">{</span><span class="s2">&quot;Content-Type&quot;</span>: <span class="s2">&quot;text/plain&quot;</span><span class="o">})</span><span class="p">;</span>
    res.write<span class="o">(</span><span class="s2">&quot;Hello\r\n&quot;</span><span class="o">)</span><span class="p">;</span>
    res.write<span class="o">(</span><span class="s2">&quot;World\r\n&quot;</span><span class="o">)</span><span class="p">;</span>
    res.end<span class="o">()</span><span class="p">;</span>
<span class="o">})</span>.listen<span class="o">(</span>8080<span class="o">)</span><span class="p">;</span></code></pre></div>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: package.json
<span class="o">{</span>
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;my-node.js&quot;</span>,
    <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;0.1.0&quot;</span>,
    <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;docker nodejs test&quot;</span>,
    <span class="s2">&quot;main&quot;</span>: <span class="s2">&quot;app.js&quot;</span>,
    <span class="s2">&quot;scripts&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;start&quot;</span>: <span class="s2">&quot;node app.js&quot;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h3 id="build--run">파일 다 만들고  Build &amp; Run</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">- 빌드 
Docker build --tag my_nodejs .
- 실행 
Docker run -it -p 8080:8080 my_nodejs</code></pre></div>
<p><br /></p>
<h2 id="section-28">멀티 컨테이너 실전 연습</h2>
<p>node.js + redis</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">동작 예<span class="o">)</span> 
http://localhost/hello/name
: name 추가
http://localhost/bye/name
: name 삭제
http://localhost/members
: name 리스트</code></pre></div>
<h3 id="section-29">프로젝트 구성</h3>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">mynode  
 ㄴ mynode  
   ㄴ app.js
   ㄴ package.json
 ㄴ Dockerfile
myredis
 ㄴdockerfile</code></pre></div>
<p>1) myreids/Dockerfile</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: myreids/Dockerfile
FROM ubuntu:16.04
MAINTAINER your name &lt;your.name@gmail.com&gt;
ENV UPDATED_AT 2016-10-23
RUN apt-get -yqq update
RUN apt-get -yqq install software-properties-common python-software-properties
RUN add-apt-repository ppa:chris-lea/redis-server
RUN apt-get -yqq update
RUN apt-get -yqq install redis-server redis-tools
VOLUME <span class="o">[</span><span class="s2">&quot;/var/lib/redis&quot;</span>, <span class="s2">&quot;/var/log/redis&quot;</span><span class="o">]</span>
EXPOSE 6379
ENTRYPOINT <span class="o">[</span><span class="s2">&quot;redis-server&quot;</span>, <span class="s2">&quot;--logfile /var/log/redis/my-redis.log&quot;</span>, <span class="s2">&quot;--protected-mode no&quot;</span><span class="o">]</span></code></pre></div>
<p>2) mynode/Dockerfile</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: mynode/Dockerfile
FROM ubuntu:16.04
MAINTAINER your name &lt;your.name@gmail.com&gt;
ENV UPDATED_AT 201610231122
RUN apt-get -yqq update
RUN apt-get -yqq install nodejs npm
RUN ln -s /usr/bin/nodejs /usr/bin/node
RUN mkdir -p /var/log/node
ADD mynode /opt/node/
WORKDIR /opt/node
RUN npm install
<span class="c">### Defendency library install</span>
EXPOSE 8080
CMD <span class="o">[</span><span class="s2">&quot;nodejs&quot;</span>, <span class="s2">&quot;app.js&quot;</span><span class="o">]</span></code></pre></div>
<p>3) mynode/mynode/app.js</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: mynode/mynode/app.js
var <span class="nv">express</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;express&#39;</span><span class="o">)</span><span class="p">;</span>
var <span class="nv">app</span> <span class="o">=</span> express<span class="o">()</span><span class="p">;</span> 
var <span class="nv">redis</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;redis&#39;</span><span class="o">)</span><span class="p">;</span>
var <span class="nv">server</span> <span class="o">=</span> require<span class="o">(</span><span class="s1">&#39;http&#39;</span><span class="o">)</span>.createServer<span class="o">(</span>app<span class="o">)</span><span class="p">;</span>
var <span class="nv">redisHost</span> <span class="o">=</span> process.env.REDIS_HOST <span class="o">||</span> <span class="s1">&#39;myredis&#39;</span><span class="p">;</span>
var <span class="nv">redisPort</span> <span class="o">=</span> 6379<span class="p">;</span>
var <span class="nv">redisClient</span> <span class="o">=</span> redis.createClient<span class="o">({</span>post: redisPort, host: redisHost<span class="o">})</span><span class="p">;</span>
app.get<span class="o">(</span><span class="s1">&#39;/&#39;</span>, <span class="k">function</span><span class="o">(</span>req, res<span class="o">)</span> <span class="o">{</span>
    res.json<span class="o">({</span>
        status: <span class="s2">&quot;ok&quot;</span>
    <span class="o">})</span><span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
app.get<span class="o">(</span><span class="s1">&#39;/hello/:name&#39;</span>, <span class="k">function</span><span class="o">(</span>req, res<span class="o">)</span> <span class="o">{</span>
    redisClient.sadd<span class="o">(</span><span class="s1">&#39;party:members&#39;</span>, req.params.name<span class="o">)</span><span class="p">;</span>
    res.json<span class="o">({</span>
        hello: req.params.name
    <span class="o">})</span><span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
app.get<span class="o">(</span><span class="s1">&#39;/bye/:name&#39;</span>, <span class="k">function</span><span class="o">(</span>req, res<span class="o">)</span> <span class="o">{</span>
    redisClient.srem<span class="o">(</span><span class="s1">&#39;party:members&#39;</span>, req.params.name<span class="o">)</span><span class="p">;</span>
    res.json<span class="o">({</span>
        bye: req.params.name
    <span class="o">})</span><span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
app.get<span class="o">(</span><span class="s1">&#39;/members&#39;</span>, <span class="k">function</span><span class="o">(</span>req, res<span class="o">)</span> <span class="o">{</span>
    redisClient.smembers<span class="o">(</span><span class="s1">&#39;party:members&#39;</span>, <span class="k">function</span><span class="o">(</span>err, reply<span class="o">)</span> <span class="o">{</span>
        res.json<span class="o">({</span>members: reply<span class="o">})</span><span class="p">;</span>
    <span class="o">})</span><span class="p">;</span>
<span class="o">})</span><span class="p">;</span>
var <span class="nv">port</span> <span class="o">=</span> process.env.HTTP_PORT <span class="o">||</span> 8080<span class="p">;</span>
server.listen<span class="o">(</span>port<span class="o">)</span><span class="p">;</span>
console.log<span class="o">(</span><span class="s1">&#39;Listening on port&#39;</span> + port<span class="o">)</span><span class="p">;</span></code></pre></div>
<p>4) myndoe/mynode/package.json<br />
Tips: 버전 명시하는게 좋음, 배포시 버전이 변경되어 에러가 발생하는 경우가 있음</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">파일명: myndoe/mynode/package.json
<span class="o">{</span>
    <span class="s2">&quot;name&quot;</span>: <span class="s2">&quot;my-node-server&quot;</span>,
    <span class="s2">&quot;version&quot;</span>: <span class="s2">&quot;0.1.0&quot;</span>,
    <span class="s2">&quot;description&quot;</span>: <span class="s2">&quot;multi container example&quot;</span>, 
    <span class="s2">&quot;dependencies&quot;</span>: <span class="o">{</span>
        <span class="s2">&quot;express&quot;</span>: <span class="s2">&quot;4.14.0&quot;</span>,
        <span class="s2">&quot;redis&quot;</span>: <span class="s2">&quot;2.6.2&quot;</span>
    <span class="o">}</span>
<span class="o">}</span></code></pre></div>
<h3 id="section-30">실행</h3>
<p>Tips: Redis 먼저 실행 할 것<br />
why ? nodejs 서버가 먼저 실행되면 Redis 링크 부분에서 에러 발생 할 수 있음.</p>
<p>1) myredis 실행</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker build -t rky0930/myredis .
docker run -d -h myredis --name myredis -p 6379:6379 rky0930/myredis
docker run -it -h myredis --name myredis -p 6379:6379 rky0930/myredis 
 : -h <span class="o">=</span>  Container host name</code></pre></div>
<p>2) mynode 실행</p>
<div class="highlight"><pre><code class="language-bash" data-lang="bash">docker build -t rky0930/mynode .
 : -t 이미지 이름
docker run -d --name mynode --link myredis:myredis -p 8080:8080 rky0930/mynode
docker run -it --name mynode --link myredis:myredis -p 8080:8080 rky0930/mynode</code></pre></div>
  <footer class="post-footer">
    <section class="author">
      <h4>Ryoo Gyoung-Yoon</h4>
      <p>Personal Tech Blog</p>
    </section>
<aside class="share">
  <h4>Share this.</h4>
  <a href="http://twitter.com/share?text=Docker&amp;url=http://rky0930.github.io/a-Docker/&amp;hashtags=web,dev,blog,soudev&amp;via=nandomoreirame"
  onclick="window.open(this.href, 'twitter-share', 'width=550,height=235');return false;">
    <i class="fa fa-twitter-square"></i>
  </a>
  <a href="https://www.facebook.com/sharer/sharer.php?u=http://rky0930.github.io/a-Docker/"
  onclick="window.open(this.href, 'facebook-share','width=580,height=296');return false;">
    <i class="fa fa-facebook-square"></i>
  </a>
</aside>
      <hr>
<aside id="comments" class="disqus">
  <h3 class="txt-center"><i class="fa fa-comments"></i> Comments</h3>
  <hr>
  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_identifier = '/a-Docker';
    var disqus_title = 'Docker';
    var disqus_url = 'http://rky0930.github.io/a-Docker/';
    /*var disqus_developer = 1;*/
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>
    Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a>
  </noscript>
</aside>
  </footer>
</article>
    </main>
<footer class="footer">
  <div class="container">
    <ul class="icons">
      <li>
        <a href="http://github.com/rky0930" class="icon-github" target="_blank">
          <i class="fa fa-github"></i>
        </a>
      </li>
      <li>
        <a href="http://facebook.com/rky0930" class="icon-facebook" target="_blank">
          <i class="fa fa-facebook"></i>
        </a>
      </li>
      <li>
        <a href="http://linkedin.com/in/rky0930" class="icon-linkedin" target="_blank">
          <i class="fa fa-linkedin"></i>
        </a>
      </li>
    </ul>
    <p>
      <q></q>
      <small>– </small>
    </p>
    <small class="clearfix">
      Made with <a href="http://jekyllrb.com" target="_blank">Jekyll</a> • <a href="https://github.com/rky0930" target="_blank">Open source <i class="fa fa-heart"></i></a>
    </small>
  </div>
</footer>
<a class="scroll-up fa fa-chevron-up bounce" href="#" data-position="0"></a>
<div id="modalSearch" class="modal">
  <div class="modal__overlay"></div>
  <div class="modal__content">
    <a href="#!" class="modal-close" data-modal-close>&times;</a>
    <div class="search-container">
      <input type="text" id="search-input" placeholder="Search in 11 articles">
      <ul id="results-container"></ul>
    </div>
  </div>
</div>
    <script src="/assets/main-52d417e8a6ff9f5b168386d37c96338a.js"></script>
  </body>
</html>